var Tree={};$(function(){var l,f=80,d=400,t=document.getElementById("tree").offsetWidth,e=document.getElementById("tree").offsetHeight;Tree.zoomfactor=1;var n=d3.behavior.zoom().scaleExtent([.5,3]).on("zoom",function(){u.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),Tree.zoomfactor=d3.event.scale}).translate([t/2-150,e/2]),u=d3.select("#tree").append("svg").attr("id","canvas").call(n).append("g").attr("id","rootg").attr("transform","translate("+(t/2-150)+","+e/2+")"),g=d3.layout.tree().nodeSize([100,100]).separation(function(){return.5}).children(function(t){return t.collapsed?void 0:t._parents});function p(t){t.collapsed?t.collapsed=!1:o(t),Tree.draw(t)}function o(t){t.collapsed=!0,t._parents&&t._parents.forEach(o)}function r(t){t.collapsed=!1,t._parents&&t._parents.forEach(r)}Tree.start=function(t,r){d3.json(t,function(t,e){if(t)return console.error(t);var a=r;!function t(e,r){if(a<=++r)o(e);else if(e._parents)for(var n=0;n<e._parents.length;n++)t(e._parents[n],r)}(e,0),l=e,(Tree.root=l).x0=0,l.y0=0,Tree.draw(l)})},Tree.draw=function(r){var t=g.nodes(l),e=g.links(t),n=u.selectAll("path.link").data(e,function(t){return t.target.id});n.enter().append("path").attr("class","link").attr("d",function(t){var e={x:r.x0,y:r.y0+40};return y({source:e,target:e})}),n.transition().duration(d).attr("d",m),n.exit().transition().duration(d).attr("d",function(t){var e={x:r.x,y:r.y+40};return y({source:e,target:e})}).remove();var a=u.selectAll("g.person").data(t,function(t){return t.id}),o=a.enter().append("g").attr("class","person").attr("transform",function(t){return"translate("+(r.y0+40)+","+r.x0+")"}).on("click",p),c=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis");o.append("path").attr("d",c([{x:-44,y:0},{x:0,y:25},{x:40,y:0},{x:42,y:0},{x:40,y:0},{x:0,y:-38},{x:-44,y:0}])).style("fill",function(t){return"f"===t.gender?"#f2d6f3":t._parents?"rgb(191, 250, 152)":"#eeeeee"}).style("stroke",function(t){return"f"===t.gender?"#b363a9":t._parents?"green":"#7d7d7d"}).attr({x:0,y:0,width:0,height:0}),o.append("text").attr("dx",0).attr("dy",0).attr("text-anchor","start").attr("class","name").text(function(t){return t.name}).style("fill-opacity",0);var s=a.transition().duration(d).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});s.select("rect").attr({x:-40,y:-20,width:f,height:40}),s.select("text").attr("text-anchor","middle").attr("alignment-baseline","central").style("fill-opacity",1);var i=a.exit().transition().duration(d).attr("transform",function(t){return"translate("+(r.y+40)+","+r.x+")"}).remove();i.select("rect").attr({x:0,y:0,width:0,height:0}),i.select("text").style("fill-opacity",0).attr("dx",0),t.forEach(function(t){t.x0=t.x,t.y0=t.y})},Tree.expandTree=function(){r(Tree.root),Tree.draw(Tree.root)},Tree.collapseTree=function(){o(Tree.root),Tree.draw(Tree.root)};var a={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0};function c(t){t._parents&&(t.depth&&(a[t.depth]+=t._parents.length),t._parents.forEach(c))}function m(t){var e=t.source.x,r=t.source.y+40,n=t.target.x,a=t.target.y-40;return"M"+r+","+e+"H"+(r+(a-r)/2)+"V"+n+"H"+a}function y(t){return"M"+t.source.y+","+t.source.x+"H"+t.source.y+"V"+t.source.x+"H"+t.source.y}Tree.longestGen=function(){c(Tree.root);var t=Object.keys(a).map(function(t){return a[t]}),e=Math.max.apply(null,t);return a={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},e},Tree.centerTree=function(){var t=document.getElementById("tree").offsetWidth/2,e=document.getElementById("tree").offsetHeight/2;n.translate([t,e]),n.scale(Tree.zoomfactor),u.transition().duration(d).attr("transform","translate("+t+","+e+") scale("+Tree.zoomfactor+")")},Tree.saveTree=function(){var t=document.getElementById("rootg").getBBox(),e=t.width,r=t.height;u.attr("transform","translate(45,"+(r-r/2)+")"),saveSvgAsPng(d3.select("svg").node(),"tree.png",{backgroundColor:"#FFFFFF",width:e+10,height:r+100})},Tree.zoom=function(t){var e=rootg.getScreenCTM().e-16,r=rootg.getScreenCTM().f-16;e=String(e),r=String(r),Tree.zoomfactor+=t,Tree.zoomfactor<.5&&(Tree.zoomfactor=.5),3<Tree.zoomfactor&&(Tree.zoomfactor=3),n.scale(Tree.zoomfactor),u.transition().duration(d).attr("transform","translate("+e+","+r+") scale("+Tree.zoomfactor+")")},Tree.zoomReset=function(){var t=rootg.getScreenCTM().e-16,e=rootg.getScreenCTM().f-16;t=String(t),e=String(e),Tree.zoomfactor=1,n.scale(Tree.zoomfactor),u.transition().duration(d).attr("transform","translate("+t+","+e+") scale("+Tree.zoomfactor+")")}});